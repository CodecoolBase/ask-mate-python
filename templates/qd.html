{% extends "layout.html" %}
{% block contents %}
<div class="container mb-4">
    <div class="card">
        <h1 class="card-header display-2">Question detail</h1>
        <div class="card-body">
            <div class="container">
                <div class="row">
                    <div class="col-md-10">
                        <h2 class="display-3 pt-4"><em>{{ question['title'] }}</em></h2>
                    </div>
                    <div class="col-md-2">
                        {% if question['image'] %}
                            <img src="/static/{{ question['image'] }}" alt="User image" class="img-thumbnail" style="width: 150px">
                        {% else %}
                            <img src="http://placehold.it/80" alt="Example image" class="img-thumbnail" style="width: 150px">
                        {% endif %}
                        <form method=POST enctype=multipart/form-data action='/upload?question_id={{ question["id"] }}'>
                            <label class="btn btn-primary btn-sm">
                                Browse <input type="file" style="display: none;" name="photo">
                            </label>
                            <button class="btn btn-primary btn-sm" type="submit">Upload</button>
                        </form>
                    </div>
                </div>
            </div>
            <div></div>
            <div class="mb-5">
                <p class="card-text lead">{{ question['message'] }}</p>
            </div>
            <small class="text-muted d-block">
                Posted on: {{ question['submission_time'] }}
            </small>
            <small class="text-muted d-block">
                Viewed: {{ question['view_number'] }} times
            </small>
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Comments</h5>
                        {% for comment in comments %}
                        {% if comment['answer_id'] == None %}
                        <div class="row">
                            <div class="col-md-1">
                                <p></p>
                            </div>
                            <div class="col-md-11">
                                <p class="card-text">{{ comment['message'] }} - comment by [] on {{ comment['submission_time']}}
                                    {% if comment['edited_count'] != None %}
                                        {% if comment['edited_count'] > 0  %}
                                        edited {{ comment['edited_count'] }} times.
                                        {% endif %}
                                    {% endif %} <a href="/comments/{{ comment['id'] }}/edit">edit</a>
                                </p>
                                <hr>
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    <a href="/question/{{ id }}/new-comment" class="btn">Add comment</a>
                </div>
            </div>
            <div class="mt-4">
                <a href="/question/{{ id }}/new-answer"><button type="button" class="btn btn-outline-primary btn-md" role="button" aria-pressed="true">Answer that question</button></a>
                <a href="/question_detail/{{ id }}/edit"><button type="button" class="btn btn-outline-primary btn-md" role="button" aria-pressed="true">Edit that question</button></a>
                <a href="/question/{{ id }}/delete"><button type="button" class="btn btn-outline-danger btn-md" role="button" aria-pressed="true">Delete that question</button></a>
                <div class="float-right mr-5 pt-3 align-bottom">
                    <a href="/question/{{ id }}/vote-up" class="mr-2"><i class="fas fa-thumbs-up  text-success"></i></a>
                    <a href="/question/{{ id }}/vote-down" class="mr-2"><i class="fas fa-thumbs-down text-danger"></i></a>
                    Votes: {{ question['vote_number'] }}
                </div>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="list-group">
        <div class="list-group-item bg-info text-white">
            <i class="fas fa-comment mr-2 text-white"></i>Answers
            <span class="badge badge-light ml-auto">{{ count }}</span>
        </div>
        {% for answer in answers %}

        <div class="card list-group-item">
            <div class="container">
                <div class="row">
                    <div class="col-md-1" style="margin:0;padding:0;">
                        {% if answer['image'] %}
                            <img src="/static/{{ answer['image'] }}" alt="User image" class="img-thumbnail" style="width: 100px">
                        {% else %}
                            <img src="http://placehold.it/80" alt="Example image" class="img-thumbnail" style="width: 100px">
                        {% endif %}
                        <form method=POST enctype=multipart/form-data action='/upload?question_id={{ question["id"] }}&answer_id={{ answer["id"] }}'>
                            <label class="btn btn-primary btn-sm">
                                Browse <input type="file" style="display: none;" name="photo">
                            </label>
                            <button class="btn btn-primary btn-sm" type="submit">Upload</button>
                        </form>
                    </div>
                    <div class="col-md-11">
                        <div>
                                <a href="/answer/delete?answer_id={{ answer['id'] }}&question_id={{ id }}"><i class="fas fa-trash float-right pt-3 text-danger"></i></a>
                            <h5 class="card-title">Answer # {{ loop.index }}</h5>
                            <p class="card-text">{{ answer['message'] }}</p>
                            <small class="text-muted d-block mt-5">
                                Posted on: {{ answer['submission_time'] }}
                            </small>
                            <div class="mt-2">
                                <a href="/answer/{{ answer['id'] }}/vote-up/{{ question['id'] }}" class="mr-2"><i class="fas fa-thumbs-up  text-success" style="margin:0;"></i></a>
                                <a href="/answer/{{ answer['id'] }}/vote-down/{{ question['id'] }}" class="mr-2"><i class="fas fa-thumbs-down text-danger" style="margin:0;"></i></a>
                                Votes: {{ answer['vote_number'] }}
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-body">
                                {% for comment in answer_comments %}
                                {% if comment['answer_id'] == answer['id'] %}
                                <div class="row">
                                    <div class="col-md-12">
                                        <p class="card-text">{{ comment['message'] }} - comment by [] on {{ comment['submission_time']}}
                                        {% if comment['edited_count'] != None %}
                                            {% if comment['edited_count'] > 0  %}
                                            edited {{ comment['edited_count'] }} times.
                                            {% endif %}
                                        {% endif %} <a href="/comments/{{ comment['id'] }}/edit">edit</a>
                                        </p>
                                        <hr>
                                    </div>
                                </div>
                                {% endif %}
                                {% endfor %}
                                <a href="/answer/{{ answer['id'] }}/new-comment" class="btn">Add comment</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {% endfor %}
    </div>
</div>
{% endblock %}
