{% extends "layout.html" %}
{% block contents %}
<div class="container mb-4">
    <div class="card">
        <h1 class="card-header display-5 text-uppercase">Question detail</h1>
        <div class="card-body">
            <div class="container">
                <div class="row">
                    <div class="col-md-10">
                        <h2 class="display-3 pt-4"><em>{{ question['title'] }}</em></h2>
                    </div>
                    <div class="col-md-2">
                        {% if question['image'] %}
                            <img src="{{ url_for('static', filename=question['image']) }}" alt="User image" class="img-thumbnail" style="width: 150px">
                        {% else %}
                            <img src="http://placehold.it/80" alt="Example image" class="img-thumbnail" style="width: 150px">
                        {% endif %}
                        <form method=POST enctype=multipart/form-data action='{{ url_for('upload', question_id=question['id']) }}'>
                            <label class="btn btn-primary btn-sm">
                                Browse <input type="file" style="display: none;" name="photo">
                            </label>
                            <button class="btn btn-primary btn-sm" type="submit">Upload</button>
                        </form>
                    </div>
                </div>
            </div>
            <div></div>
            <div class="mb-4">
                <p class="card-text lead">{{ question['message'] }}</p>
            </div>
            <div class="mb-1">
                <a href="/question/{{ question['id'] }}/new-tag"><button type="button" class="btn-light">Add tag</button></a>
                {% for tag in tags %}
                <button type="button" class="btn-dark">{{ tag['name'] }}</button><a href="/question_detail/{{ question['id'] }}/tag/{{ tag['id'] }}/delete">x</a>
                {% endfor %}
            </div>
            <small class="text-muted d-block">
                Posted on: {{ question['submission_time'] }}
            </small>
            <small class="text-muted d-block">
                Viewed: {{ question['view_number'] }} times
            </small>
            <div class="mt-4">
                <a href="{{ url_for('route_new_answer', question_id=question['id']) }}"><button type="button" class="btn btn-outline-primary btn-md" role="button" aria-pressed="true">Answer that question</button></a>
                <a href="{{ url_for('route_question_edit', question_id=question['id']) }}"><button type="button" class="btn btn-outline-primary btn-md" role="button" aria-pressed="true">Edit that question</button></a>
                <a href="/question/{{ id }}/delete"><button type="button" class="btn btn-outline-danger btn-md" role="button" aria-pressed="true">Delete that question</button></a>
                <div class="float-right mr-5 pt-3 align-bottom">
                    <i class="fas fa-thumbs-up mr-2 text-success" onclick="questionVoteUp({{ question['id'] }})"></i>
                    <i class="fas fa-thumbs-down mr-2 text-danger" onclick="questionVoteDown({{ question['id'] }})"></i>
                    Votes: <span id="question-vote-{{ question['id'] }}">{{ question['vote_number'] }}</span>
                </div>
            </div>
            <div class="container mt-3">
                <div class="card">
                    <div class="card-body">
                    <p class="card-title"><b>Comments:</b></p>
                        <hr>
                        <ul class="answer_list">
                            {% for comment in question_comments %}
                                <li class="py-3 border-bottom mb-3">
                                    <p>{{ comment['message'] }}</p>
                                    <div>
                                        <small class="text-muted mr-2">
                                            Posted on: {{ comment['submission_time'] }}
                                        </small>
                                        {% if comment['edited_count'] > 0  %}
                                            <small class="text-muted">
                                                Edited {{ comment['edited_count'] }} times
                                            </small>
                                        {% endif %}
                                        <div>
                                            <a href="{{ url_for('route_edit_comment', comment_id=comment['id']) }}" class="mr-2"><i class="fas fa-edit text-muted"></i></a>
                                            <a href="{{ url_for('route_delete_comment', comment_id=comment['id'], question_id=question['id']) }}"><i class="fas fa-trash text-muted"></i></a>
                                        </div>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                <a href="{{ url_for('route_add_comment_to_question', question_id=question['id']) }}" class="btn btn-sm btn-primary">Add comment</a>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="list-group">
        <div class="list-group-item bg-info text-white">
            <i class="fas fa-comment mr-2 text-white"></i>Answers
            <span class="badge badge-light ml-auto">{{ count }}</span>
        </div>
        {% for answer in answers %}

        <div class="card list-group-item">
            <div class="container">
                <div class="row">
                    <div class="col-md-1" style="margin:0;padding:0;">
                        {% if answer['image'] %}
                            <img src="/static/{{ answer['image'] }}" alt="User image" class="img-thumbnail" style="width: 100px">
                        {% else %}
                            <img src="http://placehold.it/80" alt="Example image" class="img-thumbnail" style="width: 100px">
                        {% endif %}
                        <form method=POST enctype=multipart/form-data action='/upload?question_id={{ question["id"] }}&answer_id={{ answer["id"] }}'>
                            <label class="btn btn-primary btn-sm">
                                Browse <input type="file" style="display: none;" name="photo">
                            </label>
                            <button class="btn btn-primary btn-sm" type="submit">Upload</button>
                        </form>
                    </div>
                    <div class="col-md-11">
                        <div>
                            <a href="{{ url_for('route_delete_answer', answer_id=answer['id'], question_id=question['id']) }}" class="float-right pt-2"><i class="fas fa-trash text-danger"></i></a>
                            <a href="{{ url_for('route_edit_answer', answer_id=answer['id'], question_id=question['id']) }}" class="float-right pt-2"><i class="fas fa-edit text-info"></i></a>
                            <h5 class="card-title">Answer # {{ loop.index }}</h5>
                            <p class="card-text">{{ answer['message'] }}</p>
                            <small class="text-muted d-block mt-5">
                                Posted on: {{ answer['submission_time'] }}
                            </small>
                            <div class="mt-2">
                                <i class="fas fa-thumbs-up mr-2 text-success" onclick="answerVoteUp({{ answer['id'] }})"></i>
                                <i class="fas fa-thumbs-down mr-2 text-danger" onclick="answerVoteDown({{ answer['id'] }})"></i>
                                Votes: <span id="answer-vote-{{ answer['id'] }}">{{ answer['vote_number'] }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container mt-3">
                <div class="card">
                    <div class="card-body">
                    <p class="card-title"><b>Comments:</b></p>
                        <hr>
                        <ul class="answer_list">
                            {% for comment in answer_comments %}
                                {% if comment['answer_id'] == answer['id'] %}
                                    <li class="py-3 border-bottom mb-3">
                                        <p>{{ comment['message'] }}</p>
                                        <div>
                                            <small class="text-muted mr-2">
                                                Posted on: {{ comment['submission_time'] }}
                                            </small>
                                            {% if comment['edited_count'] > 0  %}
                                                <small class="text-muted">
                                                    Edited {{ comment['edited_count'] }} times
                                                </small>
                                            {% endif %}
                                            <div class="mt-2">
                                                <a href="{{ url_for('route_edit_comment', comment_id=comment['id']) }}" class="mr-2"><i class="fas fa-edit text-muted" style="margin-right:0;"></i></a>
                                                <a href="{{ url_for('route_delete_comment', comment_id=comment['id'], question_id=question['id']) }}"><i class="fas fa-trash text-muted"></i></a>
                                            </div>
                                        </div>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                <a href="{{ url_for('route_add_comment_to_answer', question_id=question['id'], answer_id=answer['id']) }}" class="btn btn-sm btn-primary">Add comment</a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
